<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>访问量统计页面</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        dark: '#1E293B',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
        }
    </style>
</head>

<body class="bg-gray-50 font-sans text-dark">
    <div class="min-h-screen flex flex-col">
        <!-- 导航栏 -->
        <header class="bg-white shadow-sm sticky top-0 z-10">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <h1 class="text-2xl font-bold text-primary">
                    <i class="fa fa-bar-chart mr-2"></i>访问量统计
                </h1>
                <nav>
                    <ul class="flex space-x-6">
                        <li><a href="#" class="hover:text-primary transition-colors duration-300">首页</a></li>
                        <li><a href="#stats" class="hover:text-primary transition-colors duration-300">统计数据</a></li>
                        <li><a href="#about" class="hover:text-primary transition-colors duration-300">关于</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <!-- 主要内容 -->
        <main class="flex-grow container mx-auto px-4 py-8">
            <section class="text-center mb-16">
                <h2 class="text-[clamp(2rem,5vw,3.5rem)] font-bold mb-6">欢迎访问我的网站</h2>
                <p class="text-gray-600 text-lg max-w-3xl mx-auto mb-8">
                    这是一个使用GitHub Pages搭建的静态网页，展示了基于IP地址的访问量统计功能。
                </p>
                <div
                    class="inline-block bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105">
                    探索更多 <i class="fa fa-arrow-right ml-2"></i>
                </div>
            </section>

            <!-- 统计卡片 -->
            <section id="stats" class="mb-16">
                <h3 class="text-2xl font-bold mb-8 text-center">网站访问统计</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- 总访问量卡片 -->
                    <div class="bg-white rounded-xl p-6 card-shadow hover:shadow-lg transition-shadow duration-300">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-gray-500 font-medium">总访问量</h4>
                            <span class="bg-blue-100 text-primary p-2 rounded-full">
                                <i class="fa fa-eye"></i>
                            </span>
                        </div>
                        <p id="total-visits" class="text-3xl font-bold">0</p>
                        <p class="text-gray-500 text-sm mt-2">自网站建立以来</p>
                    </div>

                    <!-- 独立IP数卡片 -->
                    <div class="bg-white rounded-xl p-6 card-shadow hover:shadow-lg transition-shadow duration-300">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-gray-500 font-medium">独立IP数</h4>
                            <span class="bg-green-100 text-secondary p-2 rounded-full">
                                <i class="fa fa-users"></i>
                            </span>
                        </div>
                        <p id="unique-ips" class="text-3xl font-bold">0</p>
                        <p class="text-gray-500 text-sm mt-2">不同的访问来源</p>
                    </div>

                    <!-- 今日访问量卡片 -->
                    <div class="bg-white rounded-xl p-6 card-shadow hover:shadow-lg transition-shadow duration-300">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-gray-500 font-medium">今日访问量</h4>
                            <span class="bg-purple-100 text-purple-600 p-2 rounded-full">
                                <i class="fa fa-calendar-o"></i>
                            </span>
                        </div>
                        <p id="today-visits" class="text-3xl font-bold">0</p>
                        <p class="text-gray-500 text-sm mt-2">截至当前时间</p>
                    </div>

                    <!-- 您的IP信息卡片 -->
                    <div class="bg-white rounded-xl p-6 card-shadow hover:shadow-lg transition-shadow duration-300">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-gray-500 font-medium">您的IP</h4>
                            <span class="bg-amber-100 text-amber-600 p-2 rounded-full">
                                <i class="fa fa-globe"></i>
                            </span>
                        </div>
                        <p id="user-ip" class="text-xl font-bold break-all">获取中...</p>
                        <p id="user-location" class="text-gray-500 text-sm mt-2">位置信息</p>
                    </div>
                </div>
            </section>

            <!-- 访问趋势图表 -->
            <section class="mb-16">
                <h3 class="text-2xl font-bold mb-6 text-center">访问趋势</h3>
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <canvas id="visits-chart" height="300"></canvas>
                </div>
            </section>

            <!-- 关于部分 -->
            <section id="about" class="bg-white rounded-xl p-8 card-shadow">
                <h3 class="text-2xl font-bold mb-4">关于本网站</h3>
                <p class="text-gray-600 mb-4">
                    本网站使用GitHub Pages搭建，结合第三方服务实现了基于IP地址的访问量统计功能。
                    统计数据会记录访问者的IP地址（仅用于去重统计，不会用于其他用途），并展示网站的访问趋势。
                </p>
                <p class="text-gray-600">
                    由于GitHub Pages是静态托管服务，无法直接存储数据，本网站使用了第三方API来处理和存储访问统计信息。
                </p>
            </section>
        </main>

        <!-- 页脚 -->
        <footer class="bg-dark text-white py-8">
            <div class="container mx-auto px-4 text-center">
                <p>&copy; <span id="current-year"></span> 访问量统计网站 | 基于GitHub Pages搭建</p>
                <p class="text-gray-400 text-sm mt-2">
                    <i class="fa fa-code mr-1"></i> 用 <span class="text-red-500">❤</span> 制作
                </p>
            </div>
        </footer>
    </div>

    <!-- 引入Chart.js用于图表展示 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>

    <script>
        // 设置当前年份
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // 获取并显示用户IP地址
        function getUserIP() {
            // 使用第三方API获取用户IP
            fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => {
                    const userIpElement = document.getElementById('user-ip');
                    userIpElement.textContent = data.ip;

                    // 同时获取地理位置信息
                    fetch(`https://ipapi.co/${data.ip}/city/region/country_name/json/`)
                        .then(response => response.json())
                        .then(locationData => {
                            const locationText = `${locationData.country_name}, ${locationData.region}, ${locationData.city}`;
                            document.getElementById('user-location').textContent = locationText;
                        })
                        .catch(error => {
                            console.error('获取地理位置失败:', error);
                            document.getElementById('user-location').textContent = '无法获取位置信息';
                        });

                    // 发送访问记录
                    trackVisit(data.ip);
                })
                .catch(error => {
                    console.error('获取IP地址失败:', error);
                    document.getElementById('user-ip').textContent = '无法获取IP';
                });
        }

        // 跟踪访问记录
        function trackVisit(ip) {
            // 这里使用一个模拟的后端服务来处理访问统计
            // 实际应用中，你需要替换为自己的后端服务
            const apiUrl = 'https://api.example.com/track-visit'; // 替换为你的API地址

            // 构造要发送的数据
            const visitData = {
                ip: ip,
                timestamp: new Date().toISOString(),
                page: window.location.pathname
            };

            // 发送访问数据到后端
            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(visitData)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('网络响应不正常');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('访问已记录:', data);
                    // 更新统计数据
                    updateStats(data.stats);
                })
                .catch(error => {
                    console.error('记录访问失败:', error);
                    // 尝试从本地存储加载最后已知的统计数据
                    loadCachedStats();
                });
        }

        // 更新统计数据显示
        function updateStats(stats) {
            if (stats) {
                document.getElementById('total-visits').textContent = stats.totalVisits.toLocaleString();
                document.getElementById('unique-ips').textContent = stats.uniqueIps.toLocaleString();
                document.getElementById('today-visits').textContent = stats.todayVisits.toLocaleString();

                // 缓存统计数据到本地存储
                localStorage.setItem('lastStats', JSON.stringify(stats));

                // 绘制图表
                drawChart(stats.dailyData);
            }
        }

        // 从本地存储加载缓存的统计数据
        function loadCachedStats() {
            const cachedStats = localStorage.getItem('lastStats');
            if (cachedStats) {
                updateStats(JSON.parse(cachedStats));
            }
        }

        // 绘制访问趋势图表
        function drawChart(dailyData) {
            const ctx = document.getElementById('visits-chart').getContext('2d');

            // 准备图表数据
            const labels = dailyData.map(item => item.date);
            const data = dailyData.map(item => item.visits);

            // 创建图表
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '每日访问量',
                        data: data,
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        pointBackgroundColor: 'rgba(59, 130, 246, 1)',
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }

        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function () {
            getUserIP();

            // 添加平滑滚动效果
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });
        });
    </script>
</body>

</html>